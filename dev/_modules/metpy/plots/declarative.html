

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>metpy.plots.declarative &#8212; MetPy 1.5dev</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/theme-unidata.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J48T2BG3J7"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J48T2BG3J7');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/metpy/plots/declarative';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://unidata.github.io/MetPy/pst-versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        </script>
    <script src="../../../_static/doc_shared.js"></script>
    <link rel="icon" href="../../../_static/metpy_32x32.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <link rel="canonical" href="https://unidata.github.io/MetPy/latest/_modules/metpy/plots/declarative.html" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    
    
    
    <img src="../../../_static/metpy_horizontal.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/metpy_horizontal.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      dev  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../userguide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/index.html">
                        Reference Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../devel/index.html">
                        Developerâ€™s Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/index.html">
                        Example Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../userguide/SUPPORT.html">
                        Support
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/Unidata/MetPy/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Unidata/MetPy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/MetPy" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
    
    <div class="container-fluid" id="banner"></div>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../userguide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api/index.html">
                        Reference Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../devel/index.html">
                        Developerâ€™s Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../examples/index.html">
                        Example Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../userguide/SUPPORT.html">
                        Support
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/Unidata/MetPy/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Unidata/MetPy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/MetPy" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">metpy.plots.declarative</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for metpy.plots.declarative</h1><div class="highlight"><pre>
<span></span><span class="c1">#  Copyright (c) 2018,2019 MetPy Developers.</span>
<span class="c1">#  Distributed under the terms of the BSD 3-Clause License.</span>
<span class="c1">#  SPDX-License-Identifier: BSD-3-Clause</span>
<span class="sd">&quot;&quot;&quot;Declarative plotting tools.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">difflib</span> <span class="kn">import</span> <span class="n">get_close_matches</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">patheffects</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">observe</span><span class="p">,</span> <span class="n">TraitError</span><span class="p">,</span>
                       <span class="n">Tuple</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">validate</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ctables</span><span class="p">,</span> <span class="n">wx_symbols</span>
<span class="kn">from</span> <span class="nn">._mpl</span> <span class="kn">import</span> <span class="n">TextCollection</span>
<span class="kn">from</span> <span class="nn">.cartopy_utils</span> <span class="kn">import</span> <span class="n">import_cartopy</span>
<span class="kn">from</span> <span class="nn">.station_plot</span> <span class="kn">import</span> <span class="n">StationPlot</span>
<span class="kn">from</span> <span class="nn">..calc</span> <span class="kn">import</span> <span class="n">reduce_point_density</span><span class="p">,</span> <span class="n">smooth_n_point</span><span class="p">,</span> <span class="n">zoom_xarray</span>
<span class="kn">from</span> <span class="nn">..package_tools</span> <span class="kn">import</span> <span class="n">Exporter</span>
<span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">units</span>

<span class="n">ccrs</span> <span class="o">=</span> <span class="n">import_cartopy</span><span class="p">()</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">Exporter</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">lookup_projection</span><span class="p">(</span><span class="n">projection_code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a Cartopy projection based on a short abbreviation.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>

    <span class="n">projections</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lcc&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_latitude</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
                                                <span class="n">standard_parallels</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]),</span>
                   <span class="s1">&#39;ps&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span>
                   <span class="s1">&#39;mer&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">projections</span><span class="p">[</span><span class="n">projection_code</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">lookup_map_feature</span><span class="p">(</span><span class="n">feature_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a Cartopy map feature based on a name.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>

    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cartopy_utils</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">feature_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cfeature</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">AdaptiveScaler</span><span class="p">(</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span> <span class="p">((</span><span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cartopy_utils</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">AdaptiveScaler</span><span class="p">(</span><span class="s1">&#39;20m&#39;</span><span class="p">,</span> <span class="p">((</span><span class="s1">&#39;5m&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;500k&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">feat</span><span class="o">.</span><span class="n">with_scale</span><span class="p">(</span><span class="n">scaler</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_kwargs</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the keyword arguments for MapPanel plotting.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="p">,</span> <span class="s1">&#39;cartopy_crs&#39;</span><span class="p">):</span>
        <span class="c1"># Conditionally add cartopy transform if we are on a map.</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">kwargs</span>


<span class="k">class</span> <span class="nc">ValidationMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides validation of attribute names when set by user.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set only permitted attributes.&quot;&quot;&quot;</span>
        <span class="n">allowlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;handle&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;notify_change&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;panel&#39;</span>
                     <span class="p">]</span>

        <span class="n">allowlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">allowlist</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="n">get_close_matches</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">allowlist</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">closest</span><span class="p">:</span>
                <span class="n">alt</span> <span class="o">=</span> <span class="n">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">suggest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Perhaps you meant &#39;</span><span class="si">{</span><span class="n">alt</span><span class="si">}</span><span class="s2">&#39;?&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">suggest</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is not a valid attribute for </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">.&quot;</span> <span class="o">+</span> <span class="n">suggest</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MetPyHasTraits</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides modification layer on HasTraits for declarative classes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter dir to be more helpful for tab-completion in Jupyter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)),</span>
            <span class="nb">dir</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Panel</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw one or more plots.&quot;&quot;&quot;</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">PanelContainer</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collects panels and set complete figure related settings (e.g., size).&quot;&quot;&quot;</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Tuple</span><span class="p">(</span><span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">()]),</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">()])),</span>
                 <span class="n">Instance</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))],</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">size</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;This trait takes a tuple of (width, height) to set the size of the</span>
<span class="s2">    figure.</span>

<span class="s2">    This trait defaults to None and will assume the default `matplotlib.pyplot.figure` size.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">panels</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Instance</span><span class="p">(</span><span class="n">Panel</span><span class="p">))</span>
    <span class="n">panels</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of panels to plot on the figure.</span>

<span class="s2">    This trait must contain at least one panel to plot on the figure.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provide simple access for a single panel.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@panel</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panels</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;panels&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_panels_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_need_redraw&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provide access to the underlying figure object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_fig&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span>

<div class="viewcode-block" id="PanelContainer.refresh"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PanelContainer.html#metpy.plots.PanelContainer.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the rendering of all panels.&quot;&quot;&quot;</span>
        <span class="c1"># First make sure everything is properly constructed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># Trigger the graphics refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># Flush out interactive events--only ok on Agg for newer matplotlib</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span></div>

<div class="viewcode-block" id="PanelContainer.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PanelContainer.html#metpy.plots.PanelContainer.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the collection of panels.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">panels</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">panel</span><span class="o">.</span><span class="n">hold_trait_notifications</span><span class="p">():</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PanelContainer.save"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PanelContainer.html#metpy.plots.PanelContainer.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the constructed graphic as an image file.</span>

<span class="sd">        This method takes a string for saved file name. Additionally, the same arguments and</span>
<span class="sd">        keyword arguments that `matplotlib.pyplot.savefig` does.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="PanelContainer.show"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PanelContainer.html#metpy.plots.PanelContainer.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the constructed graphic on the screen.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PanelContainer.copy"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PanelContainer.html#metpy.plots.PanelContainer.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the panel container.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">MapPanel</span><span class="p">(</span><span class="n">Panel</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set figure related elements for an individual panel.</span>

<span class="sd">    Parameters that need to be set include collecting all plotting types</span>
<span class="sd">    (e.g., contours, wind barbs, etc.) that are desired to be in a given panel.</span>
<span class="sd">    Additionally, traits can be set to plot map related features (e.g., coastlines, borders),</span>
<span class="sd">    projection, graphics area, and title.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">PanelContainer</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Int</span><span class="p">(),</span> <span class="n">Int</span><span class="p">(),</span> <span class="n">default_value</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">layout</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A tuple that contains the description (nrows, ncols, index) of the</span>
<span class="s2">    panel position; default value is (1, 1, 1).</span>

<span class="s2">    This trait is set to describe the panel position and the default is for a single panel. For</span>
<span class="s2">    example, a four-panel plot will have two rows and two columns with the tuple setting for</span>
<span class="s2">    the upper-left panel as (2, 2, 1), upper-right as (2, 2, 2), lower-left as (2, 2, 3), and</span>
<span class="s2">    lower-right as (2, 2, 4). For more details see the documentation for</span>
<span class="s2">    `matplotlib.figure.Figure.add_subplot`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">plots</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Any</span><span class="p">())</span>
    <span class="n">plots</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of handles that represent the plots (e.g., `ContourPlot`,</span>
<span class="s2">    `FilledContourPlot`, `ImagePlot`) to put on a given panel.</span>

<span class="s2">    This trait collects the different plots, including contours and images, that are intended</span>
<span class="s2">    for a given panel.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">_need_redraw</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">area</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Float</span><span class="p">())],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">area</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A tuple or string value that indicates the graphical area of the plot.</span>

<span class="s2">    The tuple value corresponds to longitude/latitude box based on the projection of the map</span>
<span class="s2">    with the format (west-most longitude, east-most longitude, south-most latitude,</span>
<span class="s2">    north-most latitude). This tuple defines a box from the lower-left to the upper-right</span>
<span class="s2">    corner.</span>

<span class="s2">    This trait can also be set with a string value associated with the named geographic regions</span>
<span class="s2">    within MetPy. The tuples associated with the names are based on a PlatteCarree projection.</span>
<span class="s2">    For a CONUS region, the following strings can be used: &#39;us&#39;, &#39;spcus&#39;, &#39;ncus&#39;, and &#39;afus&#39;.</span>
<span class="s2">    For regional plots, US postal state abbreviations can be used, such as &#39;co&#39;, &#39;ny&#39;, &#39;ca&#39;,</span>
<span class="s2">    et cetera. Providing a &#39;+&#39; or &#39;-&#39; suffix to the string value will zoom in or out,</span>
<span class="s2">    respectively. Providing multiple &#39;+&#39; or &#39;-&#39; characters will zoom in or out further.</span>

<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">projection</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">Instance</span><span class="p">(</span><span class="s1">&#39;cartopy.crs.Projection&#39;</span><span class="p">)],</span> <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">projection</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string for a pre-defined projection or a Cartopy projection</span>
<span class="s2">    object.</span>

<span class="s2">    There are three pre-defined projections that can be called with a short name:</span>
<span class="s2">    Lambert conformal conic (&#39;lcc&#39;), Mercator (&#39;mer&#39;), or polar-stereographic (&#39;ps&#39;), or &#39;area&#39;</span>
<span class="s2">    to use a default projection based on the string area used. Additionally, this trait can be</span>
<span class="s2">    set to a Cartopy projection object.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">layers</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Union</span><span class="p">([</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">Instance</span><span class="p">(</span><span class="s1">&#39;cartopy.feature.Feature&#39;</span><span class="p">)]),</span>
                  <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;coastline&#39;</span><span class="p">])</span>
    <span class="n">layers</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of strings for a pre-defined feature layer or a Cartopy Feature</span>
<span class="s2">    object.</span>

<span class="s2">    Like the projection, there are a couple of pre-defined feature layers that can be called</span>
<span class="s2">    using a short name. The pre-defined layers are: &#39;coastline&#39;, &#39;states&#39;, &#39;borders&#39;, &#39;lakes&#39;,</span>
<span class="s2">    &#39;land&#39;, &#39;ocean&#39;, &#39;rivers&#39;, &#39;usstates&#39;, and &#39;uscounties&#39;. Additionally, this can accept</span>
<span class="s2">    Cartopy Feature objects.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">layers_edgecolor</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">])</span>
    <span class="n">layers_edgecolor</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of strings for a pre-defined edgecolor for a layer.</span>

<span class="s2">    An option to set a different color for the map layer edge colors. Length of list should</span>
<span class="s2">    match that of layers if not using default value. Behavior is to repeat colors if not enough</span>
<span class="s2">    provided by user. Use `None` value for &#39;ocean&#39;, &#39;lakes&#39;, &#39;rivers&#39;, and &#39;land&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">layers_linewidth</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">layers_linewidth</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of values defining the linewidth for a layer.</span>

<span class="s2">    An option to set a different color for the map layer edge colors. Length of list should</span>
<span class="s2">    match that of layers if not using default value. Behavior is to repeat colors if not enough</span>
<span class="s2">    provided by user. Use `None` value for &#39;ocean&#39;, &#39;lakes&#39;, &#39;rivers&#39;, and &#39;land&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span>
    <span class="n">title</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string to set a title for the figure.</span>

<span class="s2">    This trait sets a user-defined title that will plot at the top center of the figure.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">left_title</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">left_title</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string to set a title for the figure with the location on the</span>
<span class="s2">    top left of the figure.</span>

<span class="s2">    This trait sets a user-defined title that will plot at the top left of the figure.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">right_title</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">right_title</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string to set a title for the figure with the location on the</span>
<span class="s2">    top right of the figure.</span>

<span class="s2">    This trait sets a user-defined title that will plot at the top right of the figure.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">title_fontsize</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer or string value for the font size of the title of</span>
<span class="s2">    the figure.</span>

<span class="s2">    This trait sets the font size for the title that will plot at the top center of the figure.</span>
<span class="s2">    Accepts size in points or relative size. Allowed relative sizes are those of Matplotlib:</span>
<span class="s2">    &#39;xx-small&#39;, &#39;x-small&#39;, &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_valid_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that proposed string or tuple is valid and turn string into a tuple extent.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.plot_areas</span> <span class="kn">import</span> <span class="n">named_areas</span>

        <span class="n">area</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

        <span class="c1"># Parse string, check that string is valid, and determine extent based on string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)([-+]*)$&#39;</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s1">&quot; is not a valid area.&#39;</span><span class="p">)</span>
            <span class="n">region</span><span class="p">,</span> <span class="n">modifier</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">region</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span>
            <span class="k">elif</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">named_areas</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_area_proj</span> <span class="o">=</span> <span class="n">named_areas</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="n">named_areas</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">modifier</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s1">&quot; is not a valid string area.&#39;</span><span class="p">)</span>
        <span class="c1"># Otherwise, assume area is a tuple and check that latitudes/longitudes are valid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">west_lon</span><span class="p">,</span> <span class="n">east_lon</span><span class="p">,</span> <span class="n">south_lat</span><span class="p">,</span> <span class="n">north_lat</span> <span class="o">=</span> <span class="n">area</span>
            <span class="n">valid_west</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">&lt;=</span> <span class="n">west_lon</span> <span class="o">&lt;=</span> <span class="mi">180</span>
            <span class="n">valid_east</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">&lt;=</span> <span class="n">east_lon</span> <span class="o">&lt;=</span> <span class="mi">180</span>
            <span class="n">valid_south</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="n">south_lat</span> <span class="o">&lt;=</span> <span class="mi">90</span>
            <span class="n">valid_north</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">&lt;=</span> <span class="n">north_lat</span> <span class="o">&lt;=</span> <span class="mi">90</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">valid_west</span> <span class="ow">and</span> <span class="n">valid_east</span> <span class="ow">and</span> <span class="n">valid_south</span> <span class="ow">and</span> <span class="n">valid_north</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s1">&quot; is not a valid string area.&#39;</span><span class="p">)</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">area</span>

        <span class="k">return</span> <span class="n">extent</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;plots&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_plots_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle when our collection of plots changes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_need_redraw&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_parent_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle when the parent is changed.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_proj_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the projection as a Cartopy object.</span>

<span class="sd">        Handles looking up a string for the projection, or if the projection</span>
<span class="sd">        is set to ``&#39;data&#39;`` looks at the data for the projection.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">griddata</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;area&#39;</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_area_proj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">lookup_projection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span>
        <span class="k">return</span> <span class="n">proj</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_layer_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over all map features and return as Cartopy objects.</span>

<span class="sd">        Handle converting names of maps to auto-scaling map features.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="n">feat</span> <span class="o">=</span> <span class="n">lookup_map_feature</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span>
            <span class="k">yield</span> <span class="n">feat</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Watch traits and set the need redraw flag as necessary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_zoom_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate new bounds for zooming in or out of a given extent.</span>

<span class="sd">        ``extent`` is given as a tuple with four numeric values, in the same format as the</span>
<span class="sd">        ``area`` trait.</span>

<span class="sd">        If ``zoom`` = 0, the extent will not be changed from what was provided to the method</span>
<span class="sd">        If ``zoom`` &gt; 0, the returned extent will be smaller (zoomed in)</span>
<span class="sd">        If ``zoom`` &lt; 0, the returned extent will be larger (zoomed out)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">west_lon</span><span class="p">,</span> <span class="n">east_lon</span><span class="p">,</span> <span class="n">south_lat</span><span class="p">,</span> <span class="n">north_lat</span> <span class="o">=</span> <span class="n">extent</span>

        <span class="c1"># Turn number of pluses and minuses into a number than can scale the latitudes and</span>
        <span class="c1"># longitudes of our extent</span>
        <span class="n">zoom_multiplier</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**-</span><span class="n">zoom</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Calculate bounds for new, zoomed extent</span>
        <span class="n">new_north_lat</span> <span class="o">=</span> <span class="n">north_lat</span> <span class="o">+</span> <span class="p">(</span><span class="n">south_lat</span> <span class="o">-</span> <span class="n">north_lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoom_multiplier</span>
        <span class="n">new_south_lat</span> <span class="o">=</span> <span class="n">south_lat</span> <span class="o">-</span> <span class="p">(</span><span class="n">south_lat</span> <span class="o">-</span> <span class="n">north_lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoom_multiplier</span>
        <span class="n">new_east_lon</span> <span class="o">=</span> <span class="n">east_lon</span> <span class="o">+</span> <span class="p">(</span><span class="n">west_lon</span> <span class="o">-</span> <span class="n">east_lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoom_multiplier</span>
        <span class="n">new_west_lon</span> <span class="o">=</span> <span class="n">west_lon</span> <span class="o">-</span> <span class="p">(</span><span class="n">west_lon</span> <span class="o">-</span> <span class="n">east_lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoom_multiplier</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">new_west_lon</span><span class="p">,</span> <span class="n">new_east_lon</span><span class="p">,</span> <span class="n">new_south_lat</span><span class="p">,</span> <span class="n">new_north_lat</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the :class:`matplotlib.axes.Axes` to draw on.</span>

<span class="sd">        Creates a new instance if necessary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we haven&#39;t actually made an instance yet, make one with the right size and</span>
        <span class="c1"># map projection.</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proj_obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span>

    <span class="nd">@ax</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the :class:`matplotlib.axes.Axes` to draw on.</span>

<span class="sd">        Clears existing state as necessary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ax</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="MapPanel.refresh"><a class="viewcode-back" href="../../../api/generated/metpy.plots.MapPanel.html#metpy.plots.MapPanel.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the drawing if necessary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="n">changed</span><span class="o">.</span><span class="n">new</span></div>

<div class="viewcode-block" id="MapPanel.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.MapPanel.html#metpy.plots.MapPanel.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the panel.&quot;&quot;&quot;</span>
        <span class="c1"># Only need to run if we&#39;ve actually changed.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span><span class="p">:</span>

            <span class="c1"># Set the extent as appropriate based on the area. One special case for &#39;global&#39;.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

            <span class="c1"># Draw all of the plots.</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">p</span><span class="o">.</span><span class="n">hold_trait_notifications</span><span class="p">():</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c1"># Add all of the maps</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers_edgecolor</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layers_edgecolor</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers_linewidth</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layers_linewidth</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_layer_features</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="s1">&#39;lake&#39;</span><span class="p">,</span> <span class="s1">&#39;river&#39;</span><span class="p">]:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;face&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_edgecolor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers_linewidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>

            <span class="c1"># Use the set title or generate one.</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                                      <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                                      <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of this MapPanel.&quot;&quot;&quot;</span>
        <span class="c1"># Create new, blank instance of MapPanel</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Copy each attribute from current MapPanel to new MapPanel</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">():</span>
            <span class="c1"># The &#39;plots&#39; attribute is a list.</span>
            <span class="c1"># A copy must be made for each plot in the list.</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;plots&#39;</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plots</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="MapPanel.copy"><a class="viewcode-back" href="../../../api/generated/metpy.plots.MapPanel.html#metpy.plots.MapPanel.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the panel.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">SubsetTraits</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent common traits for subsetting data.&quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)])</span>
    <span class="n">x</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The x coordinate of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose a desired x coordinate. For example, selecting a</span>
<span class="s2">    point or transect through the projection origin, set this parameter to</span>
<span class="s2">    ``0 * units.meter``. Note that this requires your data to have an x dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">longitude</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)])</span>
    <span class="n">longitude</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The longitude coordinate of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose a desired longitude coordinate. For example,</span>
<span class="s2">    selecting a point or transect through 95 degrees west, set this parameter to</span>
<span class="s2">    ``-95 * units.degrees_east``. Note that this requires your data to have a longitude</span>
<span class="s2">    dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)])</span>
    <span class="n">y</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The y coordinate of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose a desired x coordinate. For example, selecting a</span>
<span class="s2">    point or transect through the projection origin, set this parameter to</span>
<span class="s2">    ``0 * units.meter``. Note that this requires your data to have an y dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">latitude</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)])</span>
    <span class="n">latitude</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The latitude coordinate of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose a desired latitude coordinate. For example,</span>
<span class="s2">    selecting a point or transect through 40 degrees north, set this parameter to</span>
<span class="s2">    ``40 * units.degrees_north``. Note that this requires your data to have a latitude</span>
<span class="s2">    dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">level</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)])</span>
    <span class="n">level</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The level of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose a desired plot level. For example, selecting the</span>
<span class="s2">    850-hPa level, set this parameter to ``850 * units.hPa``. Note that this requires your</span>
<span class="s2">    data to have a vertical dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Set the valid time to be plotted as a datetime object.</span>

<span class="s2">    If a forecast hour is to be plotted the time should be set to the valid future time, which</span>
<span class="s2">    can be done using the `~datetime.datetime` and `~datetime.timedelta` objects</span>
<span class="s2">    from the Python standard library. Note that this requires your data to have a time</span>
<span class="s2">    dimension coordinate.</span>
<span class="s2">    &quot;&quot;&quot;</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">Plots2D</span><span class="p">(</span><span class="n">SubsetTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The highest level class related to plotting 2D data.</span>

<span class="sd">    This class collects all common methods no matter whether plotting a scalar variable or</span>
<span class="sd">    vector. Primary settings common to all types of 2D plots include those for data subsets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Panel</span><span class="p">)</span>
    <span class="n">_need_redraw</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plot_units</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plot_units</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The desired units to plot the field in.</span>

<span class="s2">    Setting this attribute will convert the units of the field variable to the given units for</span>
<span class="s2">    plotting using the MetPy Units module.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="mf">1e0</span><span class="p">)</span>
    <span class="n">scale</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Scale the field to be plotted by the value given.</span>

<span class="s2">    This attribute will scale the field by multiplying by the scale. For example, to</span>
<span class="s2">    scale vorticity to be whole values for contouring you could set the scale to 1e5, such that</span>
<span class="s2">    the data values will be multiplied by 10^5.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cmap_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the colormap object.</span>

<span class="sd">        Handle convert the name of the colormap to an object from matplotlib or metpy.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ctables</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">get_colortable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_norm_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the normalization object.</span>

<span class="sd">        If `image_range` is a matplotlib normalization instance, returns it, otherwise converts</span>
<span class="sd">        the tuple image range to a matplotlib normalization instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_range</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_range</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">image_range</span><span class="p">)</span>

<div class="viewcode-block" id="Plots2D.clear"><a class="viewcode-back" href="../../../api/generated/metpy.plots.Plots2D.html#metpy.plots.Plots2D.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the plot.</span>

<span class="sd">        Resets all internal state and sets need for redraw.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="s1">&#39;collections&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_collections</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_handle</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Plots2D.clear_handle"><a class="viewcode-back" href="../../../api/generated/metpy.plots.Plots2D.html#metpy.plots.Plots2D.clear_handle">[docs]</a>    <span class="k">def</span> <span class="nf">clear_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the handle to the plot instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Plots2D.clear_collections"><a class="viewcode-back" href="../../../api/generated/metpy.plots.Plots2D.html#metpy.plots.Plots2D.clear_collections">[docs]</a>    <span class="k">def</span> <span class="nf">clear_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the handle collections to the plot instance.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_parent_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle setting the parent object for the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle updating the internal cache of data.</span>

<span class="sd">        Responds to changes in various subsetting parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_griddata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Can&#39;t be a Traitlet because notifications don&#39;t work with arrays for traits</span>
    <span class="c1"># notification never happens</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Xarray dataset that contains the field to be plotted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_data</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a name for the plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="Plots2D.copy"><a class="viewcode-back" href="../../../api/generated/metpy.plots.Plots2D.html#metpy.plots.Plots2D.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">PlotScalar</span><span class="p">(</span><span class="n">Plots2D</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the common elements of 2D scalar plots for single scalar value fields.</span>

<span class="sd">    Most of the other traits here are for one or more of the specific plots. Currently this</span>
<span class="sd">    allows too many options for `ContourPlot` since it does not user image_range, for</span>
<span class="sd">    example. Similar issues for `ImagePlot` and `FilledContourPlot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">field</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span>
    <span class="n">field</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Name of the field to be plotted.</span>

<span class="s2">    This is the name of the variable from the dataset that is to be plotted. An example,</span>
<span class="s2">    from a model grid file that uses the THREDDS convention for naming would be</span>
<span class="s2">    `Geopotential_height_isobaric` or `Temperature_isobaric`. For GOES-16/17 satellite data it</span>
<span class="s2">    might be `Sectorized_CMI`. To check for the variables available within a dataset, list the</span>
<span class="s2">    variables with the following command assuming the dataset was read using xarray as `ds`,</span>
<span class="s2">    `list(ds)`</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">smooth_field</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">smooth_field</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Number of smoothing passes using 9-pt smoother.</span>

<span class="s2">    By setting this parameter with an integer value it will call the MetPy 9-pt smoother and</span>
<span class="s2">    provide a smoothed field for plotting. It is best to use this smoothing for data with</span>
<span class="s2">    finer resolutions (e.g., smaller grid spacings with a lot of grid points).</span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    metpy.calc.smooth_n_point, smooth_contour</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">smooth_contour</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                            <span class="n">Tuple</span><span class="p">(</span><span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                  <span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">))])</span>
    <span class="n">smooth_contour</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Spline interpolation to smooth contours.</span>

<span class="s2">    This attribute requires settings for the `metpy.calc.zoom_xarray` function, which will</span>
<span class="s2">    produce a spline interpolation given an integer zoom factor. Either a single integer</span>
<span class="s2">    specifying the zoom factor (e.g., 4) or a tuple containing two integers for the zoom factor</span>
<span class="s2">    and the spline interpolation order can be used. The default spline interpolation order is</span>
<span class="s2">    3.</span>

<span class="s2">    This is best used to smooth contours when contouring a sparse grid (e.g., when your data</span>
<span class="s2">    has a large grid spacing).</span>

<span class="s2">    See Also</span>
<span class="s2">    --------</span>
<span class="s2">    metpy.calc.zoom_xarray, smooth_field</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle updating the internal cache of data.</span>

<span class="sd">        Responds to changes in various subsetting parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_griddata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">griddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the internal cached data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_griddata&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Select our particular field of interest</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">parse_cf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="p">,</span> <span class="s1">&#39;parse_cf&#39;</span><span class="p">):</span>
                <span class="c1"># Handles the case where we have a dataset but no specified field</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;field attribute has not been set.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

            <span class="c1"># Subset to 2D using MetPy&#39;s fancy .sel</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">dim_coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">):</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="k">if</span> <span class="n">dim_coord</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_coord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">subset</span><span class="p">[</span><span class="n">dim_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data_subset</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">data_subset</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s1">&#39;Must provide a combination of subsetting values to give either 2D&#39;</span>
                            <span class="s1">&#39; data or 3D data subset for plotting with third dimension size 3&#39;</span>
                            <span class="s1">&#39; or 4&#39;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Must provide a combination of subsetting values to give 2D data &#39;</span>
                        <span class="s1">&#39;subset for plotting&#39;</span>
                    <span class="p">)</span>
            <span class="c1"># Handle unit conversion (both direct unit specification and scaling)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_subset</span> <span class="o">=</span> <span class="n">data_subset</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">)</span>

            <span class="c1"># Handle smoothing of data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_subset</span> <span class="o">=</span> <span class="n">smooth_n_point</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_field</span><span class="p">)</span>
            <span class="c1"># Handle zoom interpolation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smooth_contour</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_contour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_contour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_contour</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">data_subset</span> <span class="o">=</span> <span class="n">zoom_xarray</span><span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_griddata</span> <span class="o">=</span> <span class="n">data_subset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_griddata</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the data for plotting.</span>

<span class="sd">        The two dimension coordinates and the data array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plot_x_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">find_axis_number</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="n">plot_y_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">find_axis_number</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">plot_x_dim</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">plot_y_dim</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">plot_x_dim</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">plot_y_dim</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span>
        <span class="p">)</span>

<div class="viewcode-block" id="PlotScalar.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotScalar.html#metpy.plots.PlotScalar.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorbar</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorbar_fontsize</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">False</span></div>


<span class="k">class</span> <span class="nc">ContourTraits</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents common contour traits.&quot;&quot;&quot;</span>

    <span class="n">contours</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">List</span><span class="p">(</span><span class="n">Float</span><span class="p">()),</span> <span class="n">Int</span><span class="p">(),</span> <span class="n">Instance</span><span class="p">(</span><span class="nb">range</span><span class="p">)],</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">contours</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of values to contour or an integer number of contour levels.</span>

<span class="s2">    This parameter sets contour or colorfill values for a plot. Values can be entered either</span>
<span class="s2">    as a Python range instance, a list of values or as an integer with the number of contours</span>
<span class="s2">    to be plotted (as per matplotlib documentation). A list can be generated by using square</span>
<span class="s2">    brackets or creating a numpy 1D array and converting it to a list with the</span>
<span class="s2">    `~numpy.ndarray.tolist` method.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">clabels</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">clabels</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A boolean (True/False) on whether to plot contour labels.</span>

<span class="s2">    To plot contour labels set this trait to ``True``, the default value is ``False``.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">label_fontsize</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer, float, or string value to set the font size of</span>
<span class="s2">    labels for contours.</span>

<span class="s2">    This trait sets the font size for labels that will plot along contour lines. Accepts</span>
<span class="s2">    size in points or relative size. Allowed relative sizes are those of Matplotlib:</span>
<span class="s2">    &#39;xx-small&#39;, &#39;x-small&#39;, &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">ColorfillTraits</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent common colorfill traits.&quot;&quot;&quot;</span>

    <span class="n">colormap</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">colormap</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The string name for a Matplolib or MetPy colormap.</span>

<span class="s2">    For example, the Blue-Purple colormap from Matplotlib can be accessed using &#39;BuPu&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">image_range</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                         <span class="n">Instance</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">)],</span> <span class="n">default_value</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">image_range</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A tuple of min and max values that represent the range of values</span>
<span class="s2">    to color the rasterized image.</span>

<span class="s2">    The min and max values entered as a tuple will be converted to a</span>
<span class="s2">    `matplotlib.colors.Normalize` instance for plotting.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">colorbar</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">colorbar</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string (horizontal/vertical) on whether to add a colorbar to the</span>
<span class="s2">    plot.</span>

<span class="s2">    To add a colorbar associated with the plot, set the trait to ``horizontal`` or</span>
<span class="s2">    ``vertical``,specifying the orientation of the produced colorbar. The default value is</span>
<span class="s2">    ``None``.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">colorbar_fontsize</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer, float, or string value to set the font size of</span>
<span class="s2">    labels for the colorbar.</span>

<span class="s2">    This trait sets the font size of labels for the colorbar. Accepts size in points or</span>
<span class="s2">    relative size. Allowed relative sizes are those of Matplotlib: &#39;xx-small&#39;, &#39;x-small&#39;,</span>
<span class="s2">    &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">ImagePlot</span><span class="p">(</span><span class="n">PlotScalar</span><span class="p">,</span> <span class="n">ColorfillTraits</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make raster image using `~matplotlib.pyplot.imshow` for satellite or colored image.&quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;colormap&#39;</span><span class="p">,</span> <span class="s1">&#39;image_range&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that just need a simple redraw.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmap_obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of contour()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the data for plotting.</span>

<span class="sd">        The two dimension coordinates and the data array</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_like</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># At least currently imshow with cartopy does not like this</span>
        <span class="k">if</span> <span class="s1">&#39;degree&#39;</span> <span class="ow">in</span> <span class="n">x_like</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
            <span class="n">x_like</span> <span class="o">=</span> <span class="n">x_like</span><span class="o">.</span><span class="n">data</span>
            <span class="n">x_like</span><span class="p">[</span><span class="n">x_like</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">360</span>

        <span class="k">return</span> <span class="n">x_like</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling any plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>

        <span class="c1"># If we&#39;re on a map, we use min/max for y and manually figure out origin to try to</span>
        <span class="c1"># avoid upside down images created by images where y[0] &gt; y[-1], as well as</span>
        <span class="c1"># specifying the transform</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_like</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_like</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_like</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_like</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;upper&#39;</span> <span class="k">if</span> <span class="n">y_like</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y_like</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;lower&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">imdata</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmap_obj</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_obj</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">ContourPlot</span><span class="p">(</span><span class="n">PlotScalar</span><span class="p">,</span> <span class="n">ContourTraits</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make contour plots by defining specific traits.&quot;&quot;&quot;</span>

    <span class="n">linecolor</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">linecolor</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string value to set the color of plotted contours; default is</span>
<span class="s2">    black.</span>

<span class="s2">    This trait can be set to any Matplotlib color</span>
<span class="s2">    (https://matplotlib.org/3.1.0/gallery/color/named_colors.html)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">linewidth</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer value to set the width of plotted contours; default value</span>
<span class="s2">    is 2.</span>

<span class="s2">    This trait changes the thickness of contour lines with a higher value plotting a thicker</span>
<span class="s2">    line.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">linestyle</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">linestyle</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string value to set the linestyle (e.g., dashed), or `None`;</span>
<span class="s2">    default is `None`, which, when using monochrome line colors, uses solid lines for positive</span>
<span class="s2">    values and dashed lines for negative values.</span>

<span class="s2">    The valid string values are those of Matplotlib which are &#39;solid&#39;, &#39;dashed&#39;, &#39;dotted&#39;, and</span>
<span class="s2">    &#39;dashdot&#39;, as well as their short codes (&#39;-&#39;, &#39;--&#39;, &#39;.&#39;, &#39;-.&#39;). The object `None`, as</span>
<span class="s2">    described above, can also be used.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;contours&#39;</span><span class="p">,</span> <span class="s1">&#39;linecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;clabels&#39;</span><span class="p">,</span> <span class="s1">&#39;label_fontsize&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of contour()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling any plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="p">,</span>
                                             <span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">,</span>
                                             <span class="n">linestyles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linestyle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clabels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">inline_spacing</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                               <span class="n">use_clabeltext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_fontsize</span><span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">FilledContourPlot</span><span class="p">(</span><span class="n">PlotScalar</span><span class="p">,</span> <span class="n">ColorfillTraits</span><span class="p">,</span> <span class="n">ContourTraits</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make color-filled contours plots by defining appropriate traits.&quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;contours&#39;</span><span class="p">,</span> <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;colormap&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of contour()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling any plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="p">,</span>
                                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmap_obj</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_obj</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">RasterPlot</span><span class="p">(</span><span class="n">PlotScalar</span><span class="p">,</span> <span class="n">ColorfillTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make raster plots by defining relevant traits.&quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;image_range&#39;</span><span class="p">,</span> <span class="s1">&#39;colorbar&#39;</span><span class="p">,</span> <span class="s1">&#39;colormap&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of pcolormesh()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the raster plot by calling any plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">imdata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">imdata</span><span class="p">,</span>
                                                <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmap_obj</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_norm_obj</span><span class="p">,</span>
                                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">PlotVector</span><span class="p">(</span><span class="n">Plots2D</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines common elements for 2D vector plots.</span>

<span class="sd">    This class collects common elements including the field trait, which is a tuple argument</span>
<span class="sd">    accepting two strings, for plotting 2D vector fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">field</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">())</span>
    <span class="n">field</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A tuple containing the two components of the vector field from the</span>
<span class="s2">    dataset in the form (east-west component, north-south component).</span>

<span class="s2">    For a wind barb plot each component of the wind must be specified and should be of the form</span>
<span class="s2">    (u-wind, v-wind).</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">pivot</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;middle&#39;</span><span class="p">)</span>
    <span class="n">pivot</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string setting the pivot point of the vector. Default value is</span>
<span class="s2">    &#39;middle&#39;.</span>

<span class="s2">    This trait takes the values of the keyword argument from `matplotlin.pyplot.barbs`:</span>
<span class="s2">    &#39;tip&#39; or &#39;middle&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">skip</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Int</span><span class="p">(),</span> <span class="n">default_value</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">skip</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A tuple of integers to indicate the number of grid points to skip between</span>
<span class="s2">    plotting vectors. Default is (1, 1).</span>

<span class="s2">    This trait is to be used to reduce the number of vectors plotted in the (east-west,</span>
<span class="s2">    north-south) components. The two values can be set to the same or different integer values</span>
<span class="s2">    depending on what is desired.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">earth_relative</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">earth_relative</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A boolean value to indicate whether the vector to be plotted</span>
<span class="s2">    is earth- or grid-relative. Default value is `True`, indicating that vectors are</span>
<span class="s2">    earth-relative.</span>

<span class="s2">    Common gridded meteorological datasets including GFS and NARR output contain wind</span>
<span class="s2">    components that are earth-relative. The primary exception is NAM output with wind</span>
<span class="s2">    components that are grid-relative. For any grid-relative vectors set this trait to</span>
<span class="s2">    `False`. This value is ignored for 2D vector fields not in the plane of the plot (e.g.,</span>
<span class="s2">    cross sections).</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">color</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">color</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A string value that controls the color of the vectors. Default value is</span>
<span class="s2">    black.</span>

<span class="s2">    This trait can be set to any named color from</span>
<span class="s2">    `Matplotlibs Colors &lt;https://matplotlib.org/3.1.0/gallery/color/named_colors.html&gt;`</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle updating the internal cache of data.</span>

<span class="sd">        Responds to changes in various subsetting parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_griddata_u</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_griddata_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">griddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the internal cached data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_griddata_u&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;field attribute not set correctly&#39;</span><span class="p">)</span>

            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">parse_cf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">parse_cf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Subset to 2D using MetPy&#39;s fancy .sel</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">dim_coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">):</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="k">if</span> <span class="n">dim_coord</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_coord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">subset</span><span class="p">[</span><span class="n">dim_coord</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
            <span class="n">data_subset_u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">data_subset_v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="o">**</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data_subset_u</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">data_subset_v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Must provide a combination of subsetting values to give 2D data subsets &#39;</span>
                    <span class="s1">&#39;for plotting&#39;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data_subset_u</span> <span class="o">=</span> <span class="n">data_subset_u</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">)</span>
                <span class="n">data_subset_v</span> <span class="o">=</span> <span class="n">data_subset_v</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_griddata_u</span> <span class="o">=</span> <span class="n">data_subset_u</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_griddata_v</span> <span class="o">=</span> <span class="n">data_subset_v</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_griddata_u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_griddata_v</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the data for plotting.</span>

<span class="sd">        The dimension coordinates and data arrays.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_earth_relative</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plot_x_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">find_axis_number</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="n">plot_y_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">find_axis_number</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">check_earth_relative</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">plot_x_dim</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">plot_y_dim</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x_like</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">plot_x_dim</span><span class="p">]]</span>
        <span class="n">y_like</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="n">plot_y_dim</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">check_earth_relative</span><span class="p">:</span>
            <span class="c1"># Conditionally apply earth v. grid relative adjustments if we are in the plane of</span>
            <span class="c1"># the plot</span>
            <span class="c1"># TODO: this seems like it could use a refactor to be more explicit about what</span>
            <span class="c1"># coords are grid x and y vs latitude and longitude (both for code readability and</span>
            <span class="c1"># error-proneness).</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth_relative</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">x_like</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span>
                <span class="n">y_like</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;degree&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">cartopy_crs</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                        <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">x_like</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">y_like</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">x_like</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">griddata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="PlotVector.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotVector.html#metpy.plots.PlotVector.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">False</span></div>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">BarbPlot</span><span class="p">(</span><span class="n">PlotVector</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make plots of wind barbs on a map with traits to refine the look of plotted elements.&quot;&quot;&quot;</span>

    <span class="n">barblength</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">barblength</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A float value that changes the length of the wind barbs. Default</span>
<span class="s2">    value is 7.</span>

<span class="s2">    This trait corresponds to the keyword length in `matplotlib.pyplot.barbs`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;barblength&#39;</span><span class="p">,</span> <span class="s1">&#39;pivot&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="s1">&#39;earth_relative&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of contour()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling needed plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="c1"># Conditionally apply the proper transform</span>
        <span class="k">if</span> <span class="s1">&#39;transform&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth_relative</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="n">wind_slice</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span>
            <span class="n">x_like</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span> <span class="n">y_like</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span>
            <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">barblength</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">ArrowPlot</span><span class="p">(</span><span class="n">PlotVector</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make plots of wind barbs on a map with traits to refine the look of plotted elements.&quot;&quot;&quot;</span>

    <span class="n">arrowscale</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">arrowscale</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Number of data units per arrow length unit, e.g., m/s per plot</span>
<span class="s2">    width; a smaller scale parameter makes the arrow longer. Default is `None`.</span>

<span class="s2">    If `None`, a simple autoscaling algorithm is used, based on the average</span>
<span class="s2">    vector length and the number of vectors. The arrow length unit is given by</span>
<span class="s2">    the `key_length` attribute.</span>

<span class="s2">    This trait corresponds to the keyword length in `matplotlib.pyplot.quiver`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">arrowkey</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Float</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">arrowkey</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Set the characteristics of an arrow key using a tuple of values</span>
<span class="s2">    representing (value, xloc, yloc, position, string).</span>

<span class="s2">    Default is `None`.</span>

<span class="s2">    If `None`, no vector key will be plotted.</span>

<span class="s2">    value default is 100</span>
<span class="s2">    xloc default is 0.85</span>
<span class="s2">    yloc default is 1.02</span>
<span class="s2">    position default is &#39;E&#39; (options are &#39;N&#39;, &#39;S&#39;, &#39;E&#39;, &#39;W&#39;)</span>
<span class="s2">    label default is an empty string</span>

<span class="s2">    If you wish to change a characteristic of the arrowkey you&#39;ll need to have a tuple of five</span>
<span class="s2">    elements, fill in the full tuple using `None` for those characteristics you wish to use the</span>
<span class="s2">    default value and put in the new values for the other elements. This trait corresponds to</span>
<span class="s2">    the keyword length in `matplotlib.pyplot.quiverkey`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;arrowscale&#39;</span><span class="p">,</span> <span class="s1">&#39;pivot&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="s1">&#39;earth_relative&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;arrowkey&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of quiver()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling needed plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">x_like</span><span class="p">,</span> <span class="n">y_like</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="c1"># Conditionally apply the proper transform</span>
        <span class="k">if</span> <span class="s1">&#39;transform&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth_relative</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="n">wind_slice</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
            <span class="n">x_like</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span> <span class="n">y_like</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span>
            <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">wind_slice</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arrowscale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># The order here needs to match the order of the tuple</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrowkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mf">1.02</span><span class="p">,</span> <span class="s1">&#39;labelpos&#39;</span><span class="p">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">key_kwargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrowkey</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">key_kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">key_kwargs</span><span class="p">)</span>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">PlotObs</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">,</span> <span class="n">ValidationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The highest level class related to plotting observed surface and upperair data.</span>

<span class="sd">    This class collects all common methods no matter whether plotting a upper-level or</span>
<span class="sd">    surface data using station plots.</span>

<span class="sd">    List of Traits:</span>
<span class="sd">      * level</span>
<span class="sd">      * time</span>
<span class="sd">      * fields</span>
<span class="sd">      * locations (optional)</span>
<span class="sd">      * time_window (optional)</span>
<span class="sd">      * formats (optional)</span>
<span class="sd">      * colors (optional)</span>
<span class="sd">      * plot_units (optional)</span>
<span class="sd">      * vector_field (optional)</span>
<span class="sd">      * vector_field_color (optional)</span>
<span class="sd">      * vector_field_length (optional)</span>
<span class="sd">      * vector_plot_units (optional)</span>
<span class="sd">      * reduce_points (optional)</span>
<span class="sd">      * fontsize (optional)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Panel</span><span class="p">)</span>
    <span class="n">_need_redraw</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">level</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(</span><span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Instance</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)],</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">level</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The level of the field to be plotted.</span>

<span class="s2">    This is a value with units to choose the desired plot level. For example, selecting the</span>
<span class="s2">    850-hPa level, set this parameter to ``850 * units.hPa``. For surface data, parameter</span>
<span class="s2">    must be set to `None`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Set the valid time to be plotted as a datetime object.</span>

<span class="s2">    If a forecast hour is to be plotted the time should be set to the valid future time, which</span>
<span class="s2">    can be done using the `~datetime.datetime` and `~datetime.timedelta` objects</span>
<span class="s2">    from the Python standard library.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">time_window</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">timedelta</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time_window</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Set a range to look for data to plot as a timedelta object.</span>

<span class="s2">    If this parameter is set, it will subset the data provided to be within the time and plus</span>
<span class="s2">    or minus the range value given. If there is more than one observation from a given station</span>
<span class="s2">    then it will keep only the most recent one for plotting purposes. Default value is to have</span>
<span class="s2">    no range. (optional)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Unicode</span><span class="p">())</span>
    <span class="n">fields</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Name of the scalar or symbol fields to be plotted.</span>

<span class="s2">    List of parameters to be plotted around station plot (e.g., temperature, dewpoint, skyc).</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">locations</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">locations</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;List of strings for scalar or symbol field plotting locations.</span>

<span class="s2">    List of parameters locations for plotting parameters around the station plot (e.g.,</span>
<span class="s2">    NW, NE, SW, SE, W, C). (optional)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">formats</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">])</span>
    <span class="n">formats</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;List of the scalar, symbol, and text field data formats. (optional)</span>

<span class="s2">    List of scalar parameters formatters or mapping values (if symbol) for plotting text and/or</span>
<span class="s2">    symbols around the station plot (e.g., for pressure variable</span>
<span class="s2">    ```lambda v: format(10 * v, &#39;.0f&#39;)[-3:]```).</span>

<span class="s2">    For symbol mapping the following options are available to be put in as a string:</span>
<span class="s2">    current_weather, sky_cover, low_clouds, mid_clouds, high_clouds, and pressure_tendency.</span>

<span class="s2">    For plotting text, use the format setting of &#39;text&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(),</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">])</span>
    <span class="n">colors</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;List of the scalar and symbol field colors.</span>

<span class="s2">    List of strings that represent the colors to be used for the variable being plotted.</span>
<span class="s2">    (optional)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">vector_field</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vector_field</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;List of the vector field to be plotted.</span>

<span class="s2">    List of vector components to combined and plotted from the center of the station plot</span>
<span class="s2">    (e.g., wind components). (optional)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">vector_field_color</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vector_field_color</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;String color name to plot the vector. (optional)&quot;&quot;&quot;</span>

    <span class="n">vector_field_length</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vector_field_length</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Integer value to set the length of the plotted vector.</span>
<span class="s2">    (optional)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">reduce_points</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">reduce_points</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Float to reduce number of points plotted. (optional)&quot;&quot;&quot;</span>

    <span class="n">plot_units</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot_units</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A list of the desired units to plot the fields in.</span>

<span class="s2">    Setting this attribute will convert the units of the field variable to the given units for</span>
<span class="s2">    plotting using the MetPy Units module, provided that units are attached to the DataFrame.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">vector_plot_units</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">vector_plot_units</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The desired units to plot the vector field in.</span>

<span class="s2">    Setting this attribute will convert the units of the field variable to the given units for</span>
<span class="s2">    plotting using the MetPy Units module, provided that units are attached to the DataFrame.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">fontsize</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer value to set the font size of station plots. Default</span>
<span class="s2">    is 10 pt.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="PlotObs.clear"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotObs.html#metpy.plots.PlotObs.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the plot.</span>

<span class="sd">        Resets all internal state and sets need for redraw.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_parent_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle setting the parent object for the plot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;vector_field&#39;</span><span class="p">,</span> <span class="s1">&#39;time_window&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle updating the internal cache of data.</span>

<span class="sd">        Responds to changes in various subsetting parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obsdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Can&#39;t be a Traitlet because notifications don&#39;t work with arrays for traits</span>
    <span class="c1"># notification never happens</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pandas dataframe that contains the fields to be plotted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_data</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a name for the plot.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obsdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the internal cached data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_obsdata&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use a copy of data so we retain all of the original data passed in unmodified</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

            <span class="c1"># Subset for a particular level if given</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="s1">&#39;magnitude&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span> <span class="o">==</span> <span class="n">mag</span><span class="p">]</span>

            <span class="c1"># Subset for our particular time</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># If data are not currently indexed by time, we need to do so choosing one of</span>
                <span class="c1"># the columns we&#39;re looking for</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                    <span class="n">time_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;valid_time&#39;</span><span class="p">,</span> <span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
                    <span class="n">dim_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_var</span> <span class="k">for</span> <span class="n">time_var</span> <span class="ow">in</span> <span class="n">time_vars</span> <span class="k">if</span>
                                 <span class="n">time_var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">dim_times</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                            <span class="s1">&#39;Time variable not found. Valid variable names are:&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dim_times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                        <span class="c1"># Convert our column of interest to a datetime</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                        <span class="n">time_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">dim_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>

                <span class="c1"># Works around the fact that traitlets 4.3 insists on sending us None by</span>
                <span class="c1"># default because timedelta(0) is Falsey.</span>
                <span class="n">window</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_window</span>

                <span class="c1"># Indexes need to be properly sorted for the slicing below to work; the</span>
                <span class="c1"># error you get if that&#39;s not the case really convoluted, which is why</span>
                <span class="c1"># we don&#39;t rely on users doing it.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">window</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="n">window</span><span class="p">]</span>

            <span class="c1"># Look for the station column</span>
            <span class="n">stn_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;stn&#39;</span><span class="p">,</span> <span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="s1">&#39;stid&#39;</span><span class="p">]</span>
            <span class="n">dim_stns</span> <span class="o">=</span> <span class="p">[</span><span class="n">stn_var</span> <span class="k">for</span> <span class="n">stn_var</span> <span class="ow">in</span> <span class="n">stn_vars</span> <span class="k">if</span> <span class="n">stn_var</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dim_stns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Station variable not found. Valid variable names are: &#39;</span>
                                     <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn_vars</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dim_stn</span> <span class="o">=</span> <span class="n">dim_stns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Make sure we only use one observation per station</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obsdata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">dim_stn</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obsdata</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plotdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the data for plotting.</span>

<span class="sd">        The data arrays, x coordinates, and y coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsdata</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dim_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsdata</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">dim_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsdata</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_data</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsdata</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lon</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">plot_data</span>

<div class="viewcode-block" id="PlotObs.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotObs.html#metpy.plots.PlotObs.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">,</span> <span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce_points&#39;</span><span class="p">,</span> <span class="s1">&#39;vector_field_color&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_need_rebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to attributes that need to regenerate everything.&quot;&quot;&quot;</span>
        <span class="c1"># Because matplotlib doesn&#39;t let you just change these properties, we need</span>
        <span class="c1"># to trigger a clear and re-call of contour()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling needed plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotdata</span>

        <span class="c1"># Use the cartopy map projection to transform station locations to the map and</span>
        <span class="c1"># then refine the number of stations plotted by setting a radius</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_proj_obj</span> <span class="o">==</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span> <span class="k">else</span> <span class="mf">100000.</span>
        <span class="n">point_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_proj_obj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">reduce_point_density</span><span class="p">(</span><span class="n">point_locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_points</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">StationPlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">lon</span><span class="p">[</span><span class="n">subset</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="n">subset</span><span class="p">],</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ob_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">):</span>
            <span class="n">field_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;plot_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;plot_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;plot_units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ob_type</span><span class="p">][</span><span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">ob_type</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ob_type</span><span class="p">][</span><span class="n">subset</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mapper</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wx_symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;formatter&#39;</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mapper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">field_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">plot_symbol</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="o">**</span><span class="n">field_kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">plot_text</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">field_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">plot_parameter</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="o">**</span><span class="n">field_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">plot_parameter</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="o">**</span><span class="n">field_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vector_kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field_color</span><span class="p">,</span>
                <span class="s1">&#39;plot_units&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_plot_units</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vector_kwargs</span><span class="p">[</span><span class="s1">&#39;plot_units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vector_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_units&#39;</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">subset</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vector_field</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">subset</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vector_kwargs</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_field_length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">plot_barb</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">vector_kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="PlotObs.copy"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotObs.html#metpy.plots.PlotObs.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">PlotGeometry</span><span class="p">(</span><span class="n">MetPyHasTraits</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot collections of Shapely objects and customize their appearance.&quot;&quot;&quot;</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Panel</span><span class="p">)</span>
    <span class="n">_need_redraw</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">geometry</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A collection of Shapely objects to plot.</span>

<span class="s2">    A collection of Shapely objects, such as the &#39;geometry&#39; column from a</span>
<span class="s2">    ``geopandas.GeoDataFrame``. Acceptable Shapely objects are ``shapely.MultiPolygon``,</span>
<span class="s2">    ``shapely.Polygon``, ``shapely.MultiLineString``, ``shapely.LineString``,</span>
<span class="s2">    ``shapely.MultiPoint``, and ``shapely.Point``.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">fill</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lightgray&#39;</span><span class="p">],</span>
                 <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fill</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Fill color(s) for polygons and points.</span>

<span class="s2">    A single string (color name or hex code) or collection of strings with which to fill</span>
<span class="s2">    polygons and points. If a collection, the first color corresponds to the first Shapely</span>
<span class="s2">    object in `geometry`, the second color corresponds to the second Shapely object, and so on.</span>
<span class="s2">    If `fill` is shorter than `geometry`, `fill` cycles back to the beginning, repeating the</span>
<span class="s2">    sequence of colors as needed. Default value is lightgray.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">stroke</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span>
                   <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stroke</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Stroke color(s) for polygons and line color(s) for lines.</span>

<span class="s2">    A single string (color name or hex code) or collection of strings with which to outline</span>
<span class="s2">    polygons and color lines. If a collection, the first color corresponds to the first Shapely</span>
<span class="s2">    object in `geometry`, the second color corresponds to the second Shapely object, and so on.</span>
<span class="s2">    If `stroke` is shorter than `geometry`, `stroke` cycles back to the beginning, repeating</span>
<span class="s2">    the sequence of colors as needed. Default value is black.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">marker</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Symbol used to denote points.</span>

<span class="s2">    Accepts any matplotlib marker. Default value is &#39;.&#39;, which plots a dot at each point.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A collection of labels corresponding to plotted geometry.</span>

<span class="s2">    A collection of strings to use as labels for geometry, such as a column from a</span>
<span class="s2">    ``Geopandas.GeoDataFrame``. The first label corresponds to the first Shapely object in</span>
<span class="s2">    `geometry`, the second label corresponds to the second Shapely object, and so on. The</span>
<span class="s2">    length of `labels` must be equal to the length of `geometry`. Labels are positioned along</span>
<span class="s2">    the edge of polygons, and below lines and points. No labels are plotted if this attribute</span>
<span class="s2">    is left undefined, or set equal to `None`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Int</span><span class="p">(),</span> <span class="n">Float</span><span class="p">(),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">default_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">label_fontsize</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;An integer or string value for the font size of labels.</span>

<span class="s2">    Accepts size in points or relative size. Allowed relative sizes are those of Matplotlib:</span>
<span class="s2">    &#39;xx-small&#39;, &#39;x-small&#39;, &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39;.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">label_facecolor</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">label_facecolor</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Font color(s) for labels.</span>

<span class="s2">    A single string (color name or hex code) or collection of strings for the font color of</span>
<span class="s2">    labels. If a collection, the first color corresponds to the label of the first Shapely</span>
<span class="s2">    object in `geometry`, the second color corresponds to the label of the second Shapely</span>
<span class="s2">    object, and so on. Default value is `stroke`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">label_edgecolor</span> <span class="o">=</span> <span class="n">Union</span><span class="p">([</span><span class="n">Instance</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">),</span> <span class="n">Unicode</span><span class="p">()],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">label_edgecolor</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Outline color(s) for labels.</span>

<span class="s2">    A single string (color name or hex code) or collection of strings for the outline color of</span>
<span class="s2">    labels. If a collection, the first color corresponds to the label of the first Shapely</span>
<span class="s2">    object in `geometry`, the second color corresponds to the label of the second Shapely</span>
<span class="s2">    object, and so on. Default value is `fill`.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_valid_geometry</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast `geometry` into a list once it is provided by user.</span>

<span class="sd">        Users can provide any kind of collection, such as a ``GeoPandas.GeoSeries``, and this</span>
<span class="sd">        turns them into a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke&#39;</span><span class="p">,</span> <span class="s1">&#39;label_facecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;label_edgecolor&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_valid_color_list</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast color-related attributes into a list once provided by user.</span>

<span class="sd">        This is necessary because _build() expects to cycle through a list of colors when</span>
<span class="sd">        assigning them to the geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">]</span>
        <span class="c1"># `color` must be a collection if it is not a string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">color</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_valid_labels</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast `labels` into a list once provided by user.&quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_label_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default text colors using `fill` and `stroke`.</span>

<span class="sd">        If `label_facecolor` or `label_edgecolor` have not been specified, provide default</span>
<span class="sd">        colors for those attributes using `fill` and `stroke`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fill&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span>
        <span class="k">elif</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;stroke&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a name for the plot.&quot;&quot;&quot;</span>
        <span class="c1"># Unlike Plots2D and PlotObs, there are no other attributes (such as &#39;fields&#39; or</span>
        <span class="c1"># &#39;levels&#39;) from which to name the plot. A generic name is returned here in case the</span>
        <span class="c1"># user does not provide their own title, in which case MapPanel.draw() looks here.</span>
        <span class="k">return</span> <span class="s1">&#39;Geometry Plot&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_position_label</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a (lon, lat) where the label of a polygon/line/point can be placed.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">MultiLineString</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Polygon</span>

        <span class="c1"># A hash of the label is used in choosing a point along the polygon or line that</span>
        <span class="c1"># will be returned. This &quot;psuedo-randomizes&quot; the position of a label, in hopes of</span>
        <span class="c1"># spatially dispersing the labels and lessening the chance that labels overlap.</span>
        <span class="n">label_hash</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)))</span>

        <span class="c1"># If object is a MultiPolygon or MultiLineString, associate the label with the single</span>
        <span class="c1"># largest Polygon or LineString from the collection. If MultiPoint, associate the label</span>
        <span class="c1"># with one of the Points in the MultiPoint, chosen based on the label hash.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">MultiLineString</span><span class="p">)):</span>
            <span class="n">geo_obj</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">geo_obj</span><span class="o">.</span><span class="n">geoms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">):</span>
            <span class="n">geo_obj</span> <span class="o">=</span> <span class="n">geo_obj</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="n">label_hash</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">geo_obj</span><span class="o">.</span><span class="n">geoms</span><span class="p">)]</span>

        <span class="c1"># Get the list of coordinates of the polygon/line/point</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">geo_obj</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">geo_obj</span><span class="o">.</span><span class="n">coords</span>

        <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="n">label_hash</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_draw_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a label to the plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            The label&#39;s text</span>
<span class="sd">        lon : float</span>
<span class="sd">            Longitude at which to position the label</span>
<span class="sd">        lat : float</span>
<span class="sd">            Latitude at which to position the label</span>
<span class="sd">        color : str (default: &#39;black&#39;)</span>
<span class="sd">            Name or hex code for the color of the text</span>
<span class="sd">        outline : str (default: &#39;white&#39;)</span>
<span class="sd">            Name or hex code of the color of the outline of the text</span>
<span class="sd">        offset : tuple (default: (0, 0))</span>
<span class="sd">            A tuple containing the x- and y-offset of the label, respectively</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_effects</span> <span class="o">=</span> <span class="p">[</span><span class="n">patheffects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="n">outline</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">TextCollection</span><span class="p">([</span><span class="n">lon</span><span class="p">],</span> <span class="p">[</span><span class="n">lat</span><span class="p">],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)],</span>
                                                 <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                                 <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                                 <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                                                 <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;demi&#39;</span><span class="p">,</span>
                                                 <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_fontsize</span><span class="p">,</span>
                                                 <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                                 <span class="n">path_effects</span><span class="o">=</span><span class="n">path_effects</span><span class="p">,</span>
                                                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()))</span>

<div class="viewcode-block" id="PlotGeometry.draw"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotGeometry.html#metpy.plots.PlotGeometry.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the plot.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;handles&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_redraw</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="PlotGeometry.copy"><a class="viewcode-back" href="../../../api/generated/metpy.plots.PlotGeometry.html#metpy.plots.PlotGeometry.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of the plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the plot by calling needed plotting methods as necessary.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="p">(</span><span class="n">LineString</span><span class="p">,</span> <span class="n">MultiLineString</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span>
                                      <span class="n">Point</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span>

        <span class="c1"># Cast attributes to a list if None, since traitlets doesn&#39;t call validators (like</span>
        <span class="c1"># `_valid_color_list()` and `_valid_labels()`) when the proposed value is None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span> <span class="ow">is</span> <span class="kc">None</span>
                                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span> <span class="ow">is</span> <span class="kc">None</span>
                                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span><span class="p">)</span>

        <span class="c1"># Each Shapely object is plotted separately with its corresponding colors and label</span>
        <span class="k">for</span> <span class="n">geo_obj</span><span class="p">,</span> <span class="n">stroke</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">fontcolor</span><span class="p">,</span> <span class="n">fontoutline</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stroke</span><span class="p">),</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fill</span><span class="p">),</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span>
                <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_facecolor</span><span class="p">),</span> <span class="n">cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_edgecolor</span><span class="p">)):</span>
            <span class="c1"># Plot the Shapely object with the appropriate method and colors</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">([</span><span class="n">geo_obj</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                                              <span class="n">facecolor</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">MultiLineString</span><span class="p">,</span> <span class="n">LineString</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">([</span><span class="n">geo_obj</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">stroke</span><span class="p">,</span>
                                              <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">geo_obj</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
                    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                                        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
                <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">geo_obj</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

            <span class="c1"># Plot labels if provided</span>
            <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
                <span class="c1"># If fontcolor is None/&#39;none&#39;, choose a font color</span>
                <span class="k">if</span> <span class="n">fontcolor</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">stroke</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
                    <span class="n">fontcolor</span> <span class="o">=</span> <span class="n">stroke</span>
                <span class="k">elif</span> <span class="n">fontcolor</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
                    <span class="n">fontcolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

                <span class="c1"># If fontoutline is None/&#39;none&#39;, choose a font outline</span>
                <span class="k">if</span> <span class="n">fontoutline</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fill</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
                    <span class="n">fontoutline</span> <span class="o">=</span> <span class="n">fill</span>
                <span class="k">elif</span> <span class="n">fontoutline</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">]:</span>
                    <span class="n">fontoutline</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

                <span class="c1"># Choose a point along the polygon/line/point to place label</span>
                <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_label</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

                <span class="c1"># If polygon, put label directly on edge of polygon. If line or point, put</span>
                <span class="c1"># label slightly below line/point.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_obj</span><span class="p">,</span> <span class="p">(</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)):</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">)</span>

                <span class="c1"># Finally, draw the label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_label</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fontcolor</span><span class="p">,</span> <span class="n">fontoutline</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      Â© Copyright 2008â€“2023, MetPy Developers.Development is supported by Unidata and the National Science Foundation..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>